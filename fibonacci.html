<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv="PRAGMA" content="NO-CACHE">
		<meta http-equiv="CACHE-CONTROL" content="NO-CACHE">
		<meta http-equiv="EXPIRES" content="Sun, 7 Dec 1941 17:42:00 GMT">
		<meta http-equiv="ROBOTS" content="NONE">
		<meta http-equiv="GOOGLEBOT" content="NOARCHIVE">
		<meta http-equiv="Content-Script-Type" content="text/javascript">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta http-equiv="Content-Style-Type" content="text/css">
		<meta name="author" content="Jason Cust">

		<style>
			code {
				font-family: monospace;
			}

			#fibMax {
				min-width: 17em;
			}
		</style>

		<script type="text/javascript">
			'use strict'; // Declaration for ECMA5 compliant JavaScript engines

			var DOC_TITLE = 'Fibonacci Sequence',
			DOC_DESC = 'This is a fibonacci sequence up to and including X.',
			getRadioVal = function ( el ) {
				var i,
				len = el.length;

				for ( i = 0; i < len; i++ ) {
					if ( el[ i ].checked) {
						return el[ i ].value;
					}
				}
			},
			getFibSequence = ( function () {
				var getFibByIndex = ( function () {
					var sq5 = Math.sqrt ( 5 ),
					gm = ( 1 + sq5 ) / 2;

					return function ( x ) {
						return Math.round( Math.pow( gm, x ) / sq5 );
					};
				})();

				return function( x ) {
					var fibs = [],
					fib;

					for ( fib = 0; fib <= x; fib = getFibByIndex( fibs.length ) ) {
						fibs.push( fib );
					}

					return fibs;
				};	
			})(),
			printOutput = function ( oLoc, str, docTitle ) {
				if ( oLoc === 'file' ) {
					var uriContent = "data:application/octet-stream," + encodeURIComponent( str );
					window.open( uriContent, docTitle );
				}
				else {
					document.getElementById( 'outputDisplay' ).textContent = str;
				}
			},
			genFibStr = function ( max, fibSeq, oFormat ) {
				var serializer = new XMLSerializer(),
				doc,
				title,
				desc,
				seqEl,
				numEl,
				docDesc = DOC_DESC.replace( 'X', max );

				if ( oFormat.match( /^(ht|x)ml$/ ) ) {
					if ( oFormat === 'html' ) {
						doc = document.implementation.createHTMLDocument( DOC_TITLE );
						title = doc.createElement( 'h3' );
						title.textContent = DOC_TITLE;
						doc.body.appendChild( title );
						desc = doc.createElement( 'h5' );
						desc.textContent = docDesc;
						doc.body.appendChild( desc );

						fibSeq.map( function( i ) {
							numEl = doc.createElement( 'p' );
							numEl.textContent = i;
							doc.body.appendChild( numEl );
						});
					}
					else {
						doc = document.implementation.createDocument( 'http://www.w3.org/1999/xhtml', 'xml', null );
						title = doc.createElement( 'title' );
						title.textContent = DOC_TITLE;
						doc.documentElement.appendChild( title );
						desc = doc.createElement( 'description' );
						desc.textContent = docDesc;
						doc.documentElement.appendChild( desc );
						seqEl = doc.createElement( 'sequence' );
						doc.documentElement.appendChild( seqEl );

						fibSeq.map( function( i ) {
							numEl = doc.createElement( 'number' );
							numEl.textContent = i;
							seqEl.appendChild( numEl );
						});
					}

					return serializer.serializeToString( doc );
				}
				else if ( oFormat === 'json' ) {
					return JSON.stringify( fibSeq, null, '\t' );
				}
				else {
					return fibSeq.join(', ');
				}
			},
			runFibSeq = function () {
				var fibMax = document.fibSeq.fibMax.value,
				oFormat = getRadioVal( document.fibSeq.outputFormat ),
				oLocation = getRadioVal( document.fibSeq.outputLocation );

				if ( fibMax > 0 && fibMax < 32000 ) {
					printOutput( oLocation, genFibStr( fibMax, getFibSequence( fibMax ), oFormat ), DOC_TITLE );
				}

				return false;
			};
		</script>
	</head>
	<body>
		<form name="fibSeq" onsubmit="return runFibSeq()">
			<fieldset>
				<legend>Fibonacci Sequence</legend>
				<label for="fibMax">Max:</label>
					<input type="number" id="fibMax" name="fibMax" placeholder="Enter a value from 1 to 31999" min="1" max="31999" autofocus required><br>
				<label>Output Format:</label>
					<input type="radio" name="outputFormat" value="text" id="outputFormatT" checked><label for="outputFormatT">Text</label>
					<input type="radio" name="outputFormat" value="html" id="outputFormatH"><label for="outputFormatH">HTML</label>
					<input type="radio" name="outputFormat" value="xml" id="outputFormatX"><label for="outputFormatX">XML</label>
					<input type="radio" name="outputFormat" value="json" id="outputFormatJ"><label for="outputFormatJ">JSON</label><br>
				<label>Output Location:</label>
					<input type="radio" name="outputLocation" value="screen" id="outputLocationS" checked><label for="outputFormatS">Screen</label>
					<input type="radio" name="outputLocation" value="file" id="outputLocationF"><label for="outputFormatF">File</label><br>
				<input type="submit" name="getFib" value="Get Sequence">
			</fieldset>
		</form>
		<code id="outputDisplay"></code>
	</body>
</html>