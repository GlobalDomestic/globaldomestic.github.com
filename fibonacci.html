<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv="PRAGMA" content="NO-CACHE">
		<meta http-equiv="CACHE-CONTROL" content="NO-CACHE">
		<meta http-equiv="EXPIRES" content="Sun, 7 Dec 1941 17:42:00 GMT">
		<meta http-equiv="ROBOTS" content="NONE">
		<meta http-equiv="GOOGLEBOT" content="NOARCHIVE">
		<meta http-equiv="Content-Script-Type" content="text/javascript">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta http-equiv="Content-Style-Type" content="text/css">
		<meta name="author" content="Jason Cust">

		<style>
			code {
				font-family: monospace;
			}

			#fibMax {
				min-width: 17em;
			}
		</style>

		<script type="text/javascript">
			'use strict'; // Declaration for ECMA5 compliant JavaScript engines

			var getRadioVal = function ( el ) {
				var i,
				len = el.length;

				for ( i = 0; i < len; i++ ) {
					if ( el[ i ].checked) {
						return el[ i ].value;
					}
				}
			},
			getFibSequence = ( function () {
				var getFibByIndex = ( function () {
					var sq5 = Math.sqrt ( 5 ),
					gm = ( 1 + sq5 ) / 2;

					return function ( index ) {
						return Math.round( Math.pow( gm, index ) / sq5 );
					};
				})();

				return function( max ) {
					var fibSeq = [],
					fib;

					for ( fib = 0; fib <= max; fib = getFibByIndex( fibSeq.length ) ) {
						fibSeq.push( fib );
					}

					return fibSeq;
				};	
			})(),
			printOutput = function ( oLoc, str, docTitle ) {
				var oDisp = document.getElementById( 'outputDisplay' );

				if ( oLoc === 'file' ) {
					oDisp.textContent = '';

					var uriContent = "data:application/octet-stream," + encodeURIComponent( str );
					window.open( uriContent, docTitle );
				}
				else {
					oDisp.textContent = str;
				}
			},
			genFibStr = function ( fibSeq, oFormat, docTitle, docDesc ) {
				var serializer = new XMLSerializer(),
				doc,
				titleEl,
				descEl,
				seqEl,
				numEl;

				if ( oFormat.match( /^(ht|x)ml$/ ) ) {
					if ( oFormat === 'html' ) {
						doc = document.implementation.createHTMLDocument( docTitle );
						titleEl = doc.createElement( 'h3' );
						titleEl.textContent = docTitle;
						doc.body.appendChild( titleEl );
						descEl = doc.createElement( 'h5' );
						descEl.textContent = docDesc;
						doc.body.appendChild( descEl );

						fibSeq.map( function( i ) {
							numEl = doc.createElement( 'p' );
							numEl.textContent = i;
							doc.body.appendChild( numEl );
						});
					}
					else {
						doc = document.implementation.createDocument( 'http://www.w3.org/1999/xhtml', 'xml', null );
						titleEl = doc.createElement( 'title' );
						titleEl.textContent = docTitle;
						doc.documentElement.appendChild( titleEl );
						descEl = doc.createElement( 'description' );
						descEl.textContent = docDesc;
						doc.documentElement.appendChild( descEl );
						seqEl = doc.createElement( 'sequence' );
						doc.documentElement.appendChild( seqEl );

						fibSeq.map( function( i ) {
							numEl = doc.createElement( 'number' );
							numEl.textContent = i;
							seqEl.appendChild( numEl );
						});
					}

					return serializer.serializeToString( doc );
				}
				else if ( oFormat === 'json' ) {
					return JSON.stringify( { title: docTitle, description: docDesc, sequence: fibSeq }, null, '\t' );
				}
				else {
					return fibSeq.join(', ');
				}
			},
			runFibSeq = function () {
				var fibMax = document.fibSeq.fibMax.value,
				oFormat = getRadioVal( document.fibSeq.outputFormat ),
				oLocation = getRadioVal( document.fibSeq.outputLocation ),
				docTitle = 'Fibonacci Sequence',
				docDesc = 'This is a fibonacci sequence up to and including X.',
				inputError = 'Input Max must be an integer between 1 and 31999.';

				if ( fibMax > 0 && fibMax < 32000 && fibMax % 1 === 0 ) {
					printOutput( oLocation, genFibStr( getFibSequence( fibMax ), oFormat, docTitle, docDesc.replace( 'X', fibMax ) ), docTitle );
				}
				else {
					printOutput( 'screen', inputError );
				}

				return false;
			};
		</script>
	</head>
	<body>
		<form name="fibSeq" onsubmit="return runFibSeq()">
			<fieldset>
				<legend>Fibonacci Sequence</legend>
				<label for="fibMax">Max:</label>
					<input type="number" id="fibMax" name="fibMax" placeholder="Enter a value from 1 to 31999" min="1" max="31999" autofocus required><br>
				<label>Output Format:</label>
					<input type="radio" name="outputFormat" value="text" id="outputFormatT" checked><label for="outputFormatT">Text</label>
					<input type="radio" name="outputFormat" value="html" id="outputFormatH"><label for="outputFormatH">HTML</label>
					<input type="radio" name="outputFormat" value="xml" id="outputFormatX"><label for="outputFormatX">XML</label>
					<input type="radio" name="outputFormat" value="json" id="outputFormatJ"><label for="outputFormatJ">JSON</label><br>
				<label>Output Location:</label>
					<input type="radio" name="outputLocation" value="screen" id="outputLocationS" checked><label for="outputFormatS">Screen</label>
					<input type="radio" name="outputLocation" value="file" id="outputLocationF"><label for="outputFormatF">File</label><br>
				<input type="submit" name="getFib" value="Get Sequence">
			</fieldset>
		</form>
		<code id="outputDisplay"></code>
	</body>
</html>